<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title><%= (attraction && (attraction.title || attraction.name)) || 'Chi tiết điểm tham quan' %> | HÀ NỘI</title>
        <meta name="description" content="<%= (attraction && (attraction.seoDescription || attraction.shortDescription)) || 'Chi tiết điểm tham quan Hà Nội' %>" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
        <link rel="stylesheet" href="/client/css/style.css" />
        <link rel="stylesheet" href="/client/css/responsive.css" />
        <link rel="stylesheet" href="/client/css/harmony.css" />
        <link rel="stylesheet" href="/client/css/attraction-detail.css" />
        <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" />
        <link rel="apple-touch-icon" sizes="180x180" href="/client/img/apple-touch-icon.png" />
        <link rel="icon" type="image/png" sizes="32x32" href="/client/img/favicon-32x32.png" />
        <link rel="icon" type="image/png" sizes="16x16" href="/client/img/favicon-16x16.png" />
        <link rel="manifest" href="/client/img/site.webmanifest" />
    </head>
    <body>
        <%- include('../../partials/header') %>
        <% /* ===========================================
             DYNAMIC DATA INITIALIZATION
             ===========================================
             Data will be managed by attraction-data.js
             This ensures clean separation of concerns
             =========================================== */ %>
        <% var attraction = (typeof attraction !== 'undefined' && attraction) ? attraction : null; %>
        <!-- Banner -->
        <header class="page-header attraction-banner" style="background-image: url('<%= (attraction && (attraction.heroImage || (attraction.images && attraction.images[0] && attraction.images[0].url))) || '/client/img/header-bg.jfif' %>');">
            <div class="header-content">
                <h2 id="quote">
                    <%= attraction && attraction.category === 'di-tich-lich-su' ? 'Di tích & Lịch sử' :
                        attraction.category === 'bao-tang' ? 'Bảo tàng & Triển lãm' :
                        attraction.category === 'pho-co' ? 'Phố cổ & Văn hóa' :
                        attraction.category === 'lang-nghe' ? 'Làng nghề & Thủ công' :
                        attraction.category === 'khu-vui-choi' ? 'Giải trí & Vui chơi' :
                        attraction.category === 'le-hoi' ? 'Lễ hội & Sự kiện' :
                        attraction.category === 'van-hoa' ? 'Văn hóa & Nghệ thuật' :
                        attraction.category === 'tu-nhien' ? 'Thiên nhiên & Cảnh quan' :
                        attraction.category === 'ton-giao' ? 'Tôn giáo & Tâm linh' : 'Điểm tham quan' %>
                </h2>
                <div class="line"></div>
                <h1><%= (attraction && (attraction.title || attraction.name)) || 'Điểm tham quan' %></h1>
                <p class="font-color">
                    <%= (attraction && attraction.shortDescription) || 'Khám phá vẻ đẹp văn hóa Hà Nội' %>
                </p>
                <% if (attraction && attraction.rating && attraction.rating.average > 0) { %>
                    <div class="banner-rating">
                        <div class="stars">
                            <% for (let i = 1; i <= 5; i++) { %>
                                <i class="fa fa-star <%= i <= Math.round(attraction.rating.average) ? 'active' : '' %>"></i>
                            <% } %>
                        </div>
                        <span class="rating-text">
                            <%= attraction.rating.average.toFixed(1) %> 
                            (<%= attraction.rating.count %> đánh giá)
                        </span>
                    </div>
                <% } %>
            </div>
        </header>

        <main class="attraction-detail main" aria-label="Nội dung chi tiết điểm tham quan">
            <div class="container">
                <!-- Map Overview Section -->
                <section id="map-overview" class="content-section map-overview">
                    <div class="itinerary-overview__map-container">
                        <div class="itinerary-overview__map-inner">
                            <div id="glanceMap"
                                 class="itinerary-overview__map"
                                 data-lat="<%= (attraction && (attraction.lat || attraction.coordinates?.lat)) || 21.028511 %>"
                                 data-lng="<%= (attraction && (attraction.lng || attraction.coordinates?.lng)) || 105.804817 %>"
                                 data-zoom="<%= (attraction && (attraction.mapZoom || attraction.map?.zoom)) || 14 %>"
                                 data-name="<%= (attraction && (attraction.title || attraction.name)) || '' %>"
                                 data-address="<%= (attraction && attraction.address) || '' %>"
                                 data-image="<%= (attraction && (attraction.heroImage || (attraction.images && attraction.images[0] && attraction.images[0].url))) || '' %>"
                                 data-url="<%= (attraction && ('/attraction/' + (attraction.slug || attraction._id))) || '' %>"
                                 data-route='<%- JSON.stringify((attraction && attraction.route) || []) %>'></div>
                            <div class="map-overview__heading">
                                <h2>Bản đồ tổng quan</h2>
                                <p>Vị trí và phạm vi điểm tham quan</p>
                            </div>
                            
                        </div>
                        <div class="itinerary-overview__map-gradient-vertical"></div>
                        <div class="itinerary-overview__map-gradient-horizontal"></div>
                    </div>
                </section>
                <!-- ===========================================
                     SECTION 1: INTRODUCTION & BASIC INFO
                     =========================================== -->
                <section id="attraction-intro" class="content-section itinerary-day no-margin-top">
                    <div class="itinerary-day__hero-wrapper">
                        <div class="itinerary-day__hero-media">
                            <img src="<%= (attraction && attraction.images && attraction.images[0] && attraction.images[0].url) || '/client/img/carousel-img5.jpg' %>" 
                                 alt="<%= (attraction && (attraction.title || attraction.name)) || 'Điểm tham quan' %>" 
                                 loading="lazy" />
                            <div class="itinerary-day__banner-title">
                                <h2>Chào mừng tới <%= (attraction && (attraction.title || attraction.name)) || 'Điểm tham quan' %></h2>
                            </div>
                        </div>
                    </div>

                    <div class="itinerary-day__overlay">
                        <div class="itinerary-day__content-container">
                            <!-- NEW LAYOUT: Side by side Introduction and Basic Info -->
                            <div class="intro-layout">
                                <!-- LEFT: Introduction -->
                                <div class="intro-section">
                                    <div class="itinerary-day__description-card">
                                        <div class="itinerary-day__description">
                                            <h3>Giới thiệu chung</h3>
                                            <div class="description-content">
                                                <p><%= (attraction && attraction.description) || 'Khám phá điểm tham quan thú vị tại Hà Nội với lịch sử và văn hóa đặc sắc.' %></p>
                                                <% if (attraction && attraction.intro) { %>
                                                    <p><%= attraction.intro %></p>
                                                <% } %>
                                                <% if (attraction && attraction.history) { %>
                                                    <h4>Lịch sử</h4>
                                                    <p><%= attraction.history %></p>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- RIGHT: Basic Info -->
                                <div class="info-section">
                                    <div class="itinerary-day__info-card">
                                        <h3>Thông tin cơ bản</h3>
                                        <ul class="itinerary-day__info-list">
                                            <li><strong>Vị trí</strong>: <%= (attraction && attraction.address) || 'Địa chỉ chưa cập nhật' %></li>
                                            
                                            <!-- Giờ mở cửa -->
                                            <% if (attraction && attraction.openHours && attraction.openHours.length > 0) { %>
                                            <li><strong>Giờ mở cửa</strong>:
                                                <ul>
                                                    <% attraction.openHours.forEach(function(hour) { %>
                                                    <li><%= hour %></li>
                                                    <% }); %>
                                                </ul>
                                            </li>
                                            <% } else if (attraction && attraction.openingHours) { %>
                                            <li><strong>Giờ mở cửa</strong>:
                                                <ul>
                                                    <% if (attraction.openingHours.summer && attraction.openingHours.summer.open && attraction.openingHours.summer.close) { %>
                                                    <li>Mùa hè: <%= attraction.openingHours.summer.open %> - <%= attraction.openingHours.summer.close %></li>
                                                    <% } %>
                                                    <% if (attraction.openingHours.winter && attraction.openingHours.winter.open && attraction.openingHours.winter.close) { %>
                                                    <li>Mùa đông: <%= attraction.openingHours.winter.open %> - <%= attraction.openingHours.winter.close %></li>
                                                    <% } %>
                                                    <% if (attraction.openingHours.general && attraction.openingHours.general.length > 0) { %>
                                                        <% attraction.openingHours.general.forEach(function(hour) { %>
                                                        <li><%= hour %></li>
                                                        <% }); %>
                                                    <% } %>
                                                </ul>
                                            </li>
                                            <% } else { %>
                                            <li><strong>Giờ mở cửa</strong>: Thông tin chưa cập nhật</li>
                                            <% } %>
                                            
                                            <!-- Giá vé -->
                                            <% if (attraction && attraction.tickets && attraction.tickets.length > 0) { %>
                                            <li><strong>Giá vé tham quan</strong>:
                                                <ul>
                                                    <% attraction.tickets.forEach(function(ticket) { %>
                                                    <li><%= ticket.type %>: <%= ticket.price %><% if (ticket.note) { %> (<%= ticket.note %>)<% } %></li>
                                                    <% }); %>
                                                </ul>
                                            </li>
                                            <% } else if (attraction && attraction.ticketPrices) { %>
                                            <li><strong>Giá vé tham quan</strong>:
                                                <ul>
                                                    <% if (attraction.ticketPrices.adult) { %>
                                                    <li>Người lớn: <%= attraction.ticketPrices.adult.toLocaleString() %> VNĐ</li>
                                                    <% } %>
                                                    <% if (attraction.ticketPrices.student) { %>
                                                    <li>Học sinh, sinh viên: <%= attraction.ticketPrices.student.toLocaleString() %> VNĐ</li>
                                                    <% } %>
                                                    <% if (attraction.ticketPrices.elderly) { %>
                                                    <li>Người cao tuổi: <%= attraction.ticketPrices.elderly.toLocaleString() %> VNĐ</li>
                                                    <% } %>
                                                    <% if (attraction.ticketPrices.child !== undefined) { %>
                                                    <li>Trẻ em: <%= attraction.ticketPrices.child === 0 ? 'Miễn phí' : attraction.ticketPrices.child.toLocaleString() + ' VNĐ' %></li>
                                                    <% } %>
                                                    <% if (attraction.ticketPrices.note) { %>
                                                    <li class="note"><%= attraction.ticketPrices.note %></li>
                                                    <% } %>
                                                </ul>
                                            </li>
                                            <% } else { %>
                                            <li><strong>Giá vé tham quan</strong>: Thông tin chưa cập nhật</li>
                                            <% } %>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Additional Info Row -->
                            <div class="additional-info-row">
                                <% if (attraction && attraction.highlights && attraction.highlights.length > 0) { %>
                                <div class="itinerary-day__highlights">
                                    <h3>Điểm nổi bật</h3>
                                    <ul class="itinerary-day__highlights-list">
                                        <% attraction.highlights.forEach(function(highlight) { %>
                                        <li><%= highlight %></li>
                                        <% }); %>
                                    </ul>
                                </div>
                                <% } %>

                                <% if (attraction && attraction.amenities && attraction.amenities.length > 0) { %>
                                <div class="itinerary-day__amenities">
                                    <h3>Tiện ích</h3>
                                    <ul class="itinerary-day__amenities-list">
                                        <% attraction.amenities.forEach(function(amenity) { %>
                                        <li><%= amenity %></li>
                                        <% }); %>
                                    </ul>
                                </div>
                                <% } %>

                                <% if (attraction && attraction.tags && attraction.tags.length > 0) { %>
                                <div class="itinerary-day__tags">
                                    <h3>Tags</h3>
                                    <div class="tags-container">
                                        <% attraction.tags.forEach(function(tag) { %>
                                        <span class="tag"><%= tag %></span>
                                        <% }); %>
                                    </div>
                                </div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ===========================================
                     SECTION 2: EXPERIENCES & GUIDELINES
                     =========================================== -->
                <section id="attraction-experiences" class="content-section itinerary-day">
                    <div class="itinerary-day__hero-wrapper">
                        <div class="itinerary-day__hero-media">
                            <img src="<%= (attraction && attraction.images && attraction.images[1] && attraction.images[1].url) || '/client/img/carousel-img4.jpg' %>" 
                                 alt="<%= (attraction && (attraction.title || attraction.name)) || 'Điểm tham quan' %> - Trải nghiệm" 
                                 loading="lazy" />
                        </div>
                    </div>

                    <div class="itinerary-day__overlay">
                        <div class="itinerary-day__content-container">
                            <div class="itinerary-day__columns">
                                <!-- LEFT COLUMN: Experiences -->
                                <div class="itinerary-day__column-left">
                                    <div class="itinerary-day__experiences">
                                        <h3>Trải nghiệm của du khách</h3>
                                        <% if (attraction && attraction.experiences && attraction.experiences.length > 0) { %>
                                        <div class="experiences-grid">
                                            <% attraction.experiences.forEach(function(experience) { %>
                                            <div class="experience-card">
                                                <div class="experience-icon">
                                                    <i class="fa <%= experience.icon || 'fa-star' %>"></i>
                                                </div>
                                                <div class="experience-content">
                                                    <h4><%= experience.title %></h4>
                                                    <p><%= experience.text %></p>
                                                    <div class="experience-meta">
                                                        <span class="duration"><i class="fa fa-clock-o"></i> <%= experience.duration %></span>
                                                        <span class="difficulty difficulty-<%= experience.difficulty ? experience.difficulty.toLowerCase() : 'easy' %>">
                                                            <i class="fa fa-signal"></i> <%= experience.difficulty || 'Dễ' %>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <% }); %>
                                        </div>
                                        <% } else { %>
                                        <div class="no-experiences">
                                            <p>Thông tin trải nghiệm đang được cập nhật. Vui lòng quay lại sau.</p>
                                        </div>
                                        <% } %>
                                    </div>
                                </div>

                                <!-- RIGHT COLUMN: Guidelines & Rules -->
                                <div class="itinerary-day__column-right">
                                    <div class="itinerary-day__guidelines">
                                        <h3>Hướng dẫn tham quan</h3>
                                        <% if (attraction && attraction.rules && attraction.rules.length > 0) { %>
                                        <ul class="itinerary-day__notes-list">
                                            <% attraction.rules.forEach(function(rule) { %>
                                            <li><%= rule %></li>
                                            <% }); %>
                                        </ul>
                                        <% } else if (attraction && attraction.notes && attraction.notes.length > 0) { %>
                                        <ul class="itinerary-day__notes-list">
                                            <% attraction.notes.forEach(function(note) { %>
                                            <li><%= note %></li>
                                            <% }); %>
                                        </ul>
                                        <% } else { %>
                                        <div class="no-guidelines">
                                            <p>Thông tin hướng dẫn đang được cập nhật.</p>
                                        </div>
                                        <% } %>
                                    </div>

                                    <% if (attraction && attraction.tips && attraction.tips.length > 0) { %>
                                    <div class="itinerary-day__tips">
                                        <h3>Mẹo tham quan</h3>
                                        <ul class="itinerary-day__tips-list">
                                            <% attraction.tips.forEach(function(tip) { %>
                                            <li><%= tip %></li>
                                            <% }); %>
                                        </ul>
                                    </div>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- Gallery Section -->
                <section id="gallery" class="content-section">
                    <div class="section-header">
                        <h2>Hình ảnh</h2>
                        <p>Khám phá vẻ đẹp qua những bức ảnh</p>
                    </div>
                    
                    <div class="gallery-grid">
                        <% if (attraction && attraction.images && attraction.images.length > 0) { %>
                            <% attraction.images.forEach(function(img, index) { %>
                                <div class="gallery-item" data-index="<%= index %>">
                                    <img src="<%= img.url %>" 
                                         alt="<%= img.alt || img.caption || 'Hình ảnh điểm tham quan' %>" 
                                         loading="lazy" />
                                    <div class="gallery-overlay">
                                        <button class="gallery-btn" type="button">
                                            <i class="fa fa-search-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            <% }); %>
                        <% } else { %>
                            <div class="no-gallery">
                                <p>Hình ảnh đang được cập nhật</p>
                            </div>
                        <% } %>
                    </div>
                </section>

                <!-- Reviews Section (Pro) -->
                <section id="reviews" class="content-section reviews-pro">
                    <div class="reviews-pro__header">
                        <div class="reviews-pro__heading">
                            <h2>Đừng chỉ nghe chúng tôi, hãy nghe du khách</h2>
                            <p class="subheading">Chúng tôi yêu du khách của mình – và rất vui vì điều đó là tương hỗ.</p>
                        </div>
                        <div class="reviews-pro__provider">
                            <img class="reviews-pro__provider-icon" src="/client/img/google.svg" alt="Google reviews" />
                            <div class="reviews-pro__provider-stats">
                                <span class="overall"><%= (attraction && attraction.rating && attraction.rating.average) ? attraction.rating.average.toFixed(1) : '0.0' %></span>
                                <span class="stars" aria-label="<%= (attraction && attraction.rating && attraction.rating.average) ? Math.round(attraction.rating.average) : 0 %> sao">
                                    <% for (let i = 1; i <= 5; i++) { %>
                                        <i class="fa fa-star <%= i <= Math.round((attraction && attraction.rating && attraction.rating.average) || 0) ? 'active' : '' %>"></i>
                                    <% } %>
                                </span>
                                <a class="reviews-pro__link" href="#reviews" rel="noreferrer">Xem tất cả đánh giá</a>
                                <span class="total">(<%= (attraction && attraction.rating && attraction.rating.count) || 0 %>)</span>
                            </div>
                        </div>
                    </div>

                    <div class="reviews-pro__slider">
                        <button class="reviews-pro__nav prev" type="button" aria-label="Trước">&#10094;</button>
                        <div class="reviews-pro__viewport">
                            <div class="reviews-pro__track">
                                <% if (attraction && attraction.reviews && attraction.reviews.length > 0) { %>
                                    <% attraction.reviews.forEach(function(review) { %>
                                    <div class="reviews-pro__card">
                                        <img class="reviews-pro__quote" src="/client/img/quote.svg" alt="Quote" />
                                        <div class="reviews-pro__text"><%= review.comment || review.content || 'Đánh giá từ khách du lịch' %></div>
                                        <div class="reviews-pro__stars">
                                            <% for (var i=0;i<review.rating;i++){ %><i class="fa fa-star"></i><% } %>
                                        </div>
                                        <div class="reviews-pro__meta">
                                            <span class="name"><%= review.user %></span>
                                            <span class="dot"></span>
                                            <span class="country"><%= review.country || 'Việt Nam' %></span>
                                        </div>
                                    </div>
                                    <% }); %>
                                <% } else { %>
                                    <div class="no-reviews">
                                        <div class="reviews-pro__card">
                                            <img class="reviews-pro__quote" src="/client/img/quote.svg" alt="Quote" />
                                            <div class="reviews-pro__text">Chưa có đánh giá nào. Hãy là người đầu tiên chia sẻ trải nghiệm của bạn!</div>
                                            <div class="reviews-pro__stars">
                                                <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>
                                            </div>
                                            <div class="reviews-pro__meta">
                                                <span class="name">Khách du lịch</span>
                                                <span class="dot"></span>
                                                <span class="country">Việt Nam</span>
                                            </div>
                                        </div>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                        <div class="reviews-pro__dots" role="tablist" aria-label="Chuyển trang đánh giá"></div>
                        <button class="reviews-pro__nav next" type="button" aria-label="Sau">&#10095;</button>
                    </div>
                </section>
            </div>
        </main>

        <!-- Gallery Modal -->
        <div class="gallery-modal" id="galleryModal">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <button class="modal-close" type="button">
                    <i class="fa fa-times"></i>
                </button>
                <div class="modal-nav">
                    <button class="nav-prev" type="button">
                        <i class="fa fa-chevron-left"></i>
                    </button>
                    <button class="nav-next" type="button">
                        <i class="fa fa-chevron-right"></i>
                    </button>
                </div>
                <div class="modal-image">
                    <img src="" alt="Gallery image" />
                </div>
                <div class="modal-info">
                    <span class="image-counter">1 / 4</span>
                </div>
            </div>
        </div>

        <!-- Review Modal -->
        <div class="review-modal" id="reviewModal">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Viết đánh giá</h3>
                    <button class="modal-close" type="button">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                <form class="review-form">
                    <div class="form-group">
                        <label>Đánh giá của bạn</label>
                        <div class="rating-input">
                            <input type="radio" name="rating" value="5" id="star5" />
                            <label for="star5"><i class="fa fa-star"></i></label>
                            <input type="radio" name="rating" value="4" id="star4" />
                            <label for="star4"><i class="fa fa-star"></i></label>
                            <input type="radio" name="rating" value="3" id="star3" />
                            <label for="star3"><i class="fa fa-star"></i></label>
                            <input type="radio" name="rating" value="2" id="star2" />
                            <label for="star2"><i class="fa fa-star"></i></label>
                            <input type="radio" name="rating" value="1" id="star1" />
                            <label for="star1"><i class="fa fa-star"></i></label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="reviewText">Nhận xét</label>
                        <textarea id="reviewText" placeholder="Chia sẻ trải nghiệm của bạn..." rows="4"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-outline" id="cancelReview">Hủy</button>
                        <button type="submit" class="btn-primary">Gửi đánh giá</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- up scroll -->
        <i class="arrow" onclick="topFunction()" id="upbtn"></i>

        <!--footer-->
        <%- include('../../partials/footer') %>
        <!--footer-->

        <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
        <script src="/client/js/includes.js"></script>
        <script src="/client/js/script.js"></script>
        <script src="/client/js/attraction-data.js"></script>
        <script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>
        <script src="/client/js/attraction-detail.js"></script>
        
        <!-- Initialize Dynamic Data -->
        <script>
            // Initialize attraction data with server data
            window.AttractionData.initialize(null);
        </script>
    </body>
    </html>

