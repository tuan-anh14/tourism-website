<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title><%= pageTitle %> | HÃ€ Ná»˜I</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
        <link rel="stylesheet" href="/client/css/style.css" />
        <link rel="stylesheet" href="/client/css/responsive.css" />
        <link rel="stylesheet" href="/client/css/harmony.css" />
        <link rel="stylesheet" href="/client/css/review-widgets.css" />
        <link rel="stylesheet" href="/client/css/entertainment-detail.css" />
        <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" />
        <link rel="apple-touch-icon" sizes="180x180" href="/client/img/apple-touch-icon.png" />
        <link rel="icon" type="image/png" sizes="32x32" href="/client/img/favicon-32x32.png" />
        <link rel="icon" type="image/png" sizes="16x16" href="/client/img/favicon-16x16.png" />
        <link rel="manifest" href="/client/img/site.webmanifest" />
    </head>
    <body>
        <%- include('../../partials/header') %>

        <!-- Banner -->
        <header class="page-header entertainment-banner" style="background-image: url('<%= detail.heroImage %>');">
            <div class="header-content">
                <h2 id="quote">VÄƒn hoÃ¡ & Nghá»‡ thuáº­t</h2>
                <div class="line"></div>
                <h1><%= detail.title %></h1>
                <p class="font-color">Tráº£i nghiá»‡m nghá»‡ thuáº­t giá»¯a lÃ²ng Thá»§ Ä‘Ã´</p>
            </div>
        </header>

        <section class="detail-container">
            <!-- Quick Info -->
            <div class="quick-info">
                <% (detail.quickInfo || []).forEach(function(info){ %>
                    <article class="info-card">
                        <div class="info-card-icon"><%= info.icon %></div>
                        <h3><%= info.label %></h3>
                        <p class="font-color"><%= info.value %></p>
                    </article>
                <% }) %>
            </div>

            <!-- Intro -->
            <section class="content-section">
                <h2 class="dark"><%= detail.intro.title %></h2>
                <% (detail.intro.paragraphs || []).forEach(function(p){ %>
                    <p class="font-color"><%= p %></p>
                <% }) %>

                <% (detail.sections || []).forEach(function(sec){ %>
                    <h3 class="dark"><%= sec.title %></h3>
                    <% (sec.paragraphs || []).forEach(function(p){ %>
                        <p class="font-color"><%= p %></p>
                    <% }) %>
                    <% if (sec.bullets && sec.bullets.length) { %>
                        <ul>
                            <% sec.bullets.forEach(function(b){ %>
                                <li class="font-color"><%= b %></li>
                            <% }) %>
                        </ul>
                    <% } %>
                <% }) %>

                <% if (detail.highlight) { %>
                    <div class="highlight-box">
                        <h4 class="dark">ðŸ’¡ <%= detail.highlight.title %></h4>
                        <p class="font-color"><%= detail.highlight.content %></p>
                    </div>
                <% } %>
            </section>

            <!-- Media Showcase Section (Hero + Thumbnails) -->
            <section id="media-showcase" class="content-section media-showcase">
                <% 
                    const mediaImages = (entertainment && entertainment.images) || []; 
                    const mediaHero = mediaImages[0] && mediaImages[0].url ? mediaImages[0].url : '/client/img/carousel-img3.jpg';
                    const mediaThumbs = mediaImages.slice(0, 6);
                %>
                <div class="media-hero-wrapper">
                <div class="media-hero" style="background-image: url('<%= mediaHero %>');" data-images='[<%=(mediaImages && mediaImages.length ? mediaImages.map(i=>`"${i.url}"`).join(',') : '')%>]' data-index="0">
                    <div class="media-hero__overlay"></div>
                    <div class="media-hero__content">
                        <h2 class="media-hero__title">HÃ¬nh áº£nh</h2>
                        <p class="media-hero__subtitle">KhÃ¡m phÃ¡ váº» Ä‘áº¹p qua nhá»¯ng bá»©c áº£nh ná»•i báº­t cá»§a Ä‘á»‹a Ä‘iá»ƒm nÃ y</p>
                    </div>
                    <button class="media-hero__nav prev" type="button" aria-label="áº¢nh trÆ°á»›c"><i class="fa fa-chevron-left"></i></button>
                    <button class="media-hero__nav next" type="button" aria-label="áº¢nh sau"><i class="fa fa-chevron-right"></i></button>
                    <button class="media-hero__zoom" type="button" aria-label="PhÃ³ng to"><i class="fa fa-search-plus"></i></button>
                </div>
                </div>
                <div class="media-thumbs">
                    <div class="media-thumbs__header"></div>
                    <div class="media-thumbs__grid">
                        <% if (mediaThumbs.length > 0) { %>
                            <% mediaThumbs.forEach(function(img){ %>
                                <button class="thumb" type="button" data-src="<%= img.url %>">
                                    <span class="thumb__img" style="background-image:url('<%= img.url %>')"></span>
                                </button>
                            <% }); %>
                        <% } else { %>
                            <div class="no-gallery"><p>HÃ¬nh áº£nh Ä‘ang Ä‘Æ°á»£c cáº­p nháº­t</p></div>
                        <% } %>
                    </div>
                </div>
            </section>

            <!-- Notes -->
            <% if (entertainment.notes && entertainment.notes.length > 0) { %>
                <section class="content-section">
                    <h2 class="dark">LÆ°u Ã½ khi tham quan</h2>
                    <div class="highlight-box">
                        <ul>
                            <% entertainment.notes.forEach(function(note){ %>
                                <li class="font-color"><%= note %></li>
                            <% }) %>
                        </ul>
                    </div>
                </section>
            <% } %>

             <!-- Reviews (shared review widget) -->
             <%- include('../../components/review-widget', { item: entertainment }) %>

            <!-- Map (MapLibre, tÃ¡i sá»­ dá»¥ng logic giá»‘ng attractions, nhÆ°ng pháº¡m vi nhá») -->
            <section class="content-section">
                <h2 class="dark">Vá»‹ trÃ­</h2>
                <div class="itinerary-overview__map-container">
                    <div class="itinerary-overview__map-inner">
                        <div id="entMap"
                             class="itinerary-overview__map"
                             data-lat="<%= (entertainment && entertainment.map && entertainment.map.lat) || 21.028511 %>"
                             data-lng="<%= (entertainment && entertainment.map && entertainment.map.lng) || 105.804817 %>"
                             data-zoom="<%= (detail && detail.mapZoom) || 14 %>"
                             data-name="<%= entertainment && entertainment.name %>"
                             data-address="<%= entertainment && entertainment.address %>"
                             data-image="<%= (entertainment && entertainment.images && entertainment.images[0] && entertainment.images[0].url) || '' %>"></div>
                        <div class="map-overview__heading">
                            <h2>Báº£n Ä‘á»“ vá»‹ trÃ­</h2>
                            <p>Vá»‹ trÃ­ Ä‘á»‹a Ä‘iá»ƒm giáº£i trÃ­ trÃªn báº£n Ä‘á»“</p>
                        </div>
                    </div>
                    <div class="itinerary-overview__map-gradient-vertical"></div>
                    <div class="itinerary-overview__map-gradient-horizontal"></div>
                </div>
            </section>

            <!-- CTA -->
            <section class="cta-section">
                <h2 class="dark"><%= detail.cta.title %></h2>
                <p class="font-color" style="margin-bottom: 16px;"><%= detail.cta.subtitle %></p>
                <% (detail.cta.actions || []).forEach(function(act){ %>
                    <a href="<%= act.href %>" class="btn"><%= act.label %></a>
                <% }) %>
            </section>
        </section>

        <!-- Gallery Modal -->
        <div class="gallery-modal" id="galleryModal">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <button class="modal-close" type="button">
                    <i class="fa fa-times"></i>
                </button>
                <div class="modal-nav">
                    <button class="nav-prev" type="button">
                        <i class="fa fa-chevron-left"></i>
                    </button>
                    <button class="nav-next" type="button">
                        <i class="fa fa-chevron-right"></i>
                    </button>
                </div>
                <div class="modal-image">
                    <img src="" alt="Gallery image" />
                </div>
                <div class="modal-info">
                    <span class="image-counter">1 / 4</span>
                </div>
            </div>
        </div>

        

        <!-- up scroll -->
        <i class="arrow" onclick="topFunction()" id="upbtn"></i>

        <!--footer-->
        <%- include('../../partials/footer') %>

        <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
        <script src="/client/js/includes.js"></script>
        <script src="/client/js/script.js"></script>
        <script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>
        <script>
        document.addEventListener('DOMContentLoaded', function(){
            var el = document.getElementById('entMap');
            if(!el || typeof maplibregl === 'undefined') return;
            var lat = parseFloat(el.getAttribute('data-lat') || '21.028511');
            var lng = parseFloat(el.getAttribute('data-lng') || '105.804817');
            var zoom = parseFloat(el.getAttribute('data-zoom') || '14');
            // DÃ¹ng tiles miá»…n phÃ­ tá»« OpenStreetMap via MapTiler demo (an toÃ n cho demo). CÃ³ thá»ƒ thay báº±ng key riÃªng náº¿u cáº§n.
            var styleUrl = 'https://demotiles.maplibre.org/style.json';
            var map = new maplibregl.Map({ container: 'entMap', style: styleUrl, center: [lng, lat], zoom: zoom, attributionControl: true });
            map.addControl(new maplibregl.NavigationControl(), 'top-right');
            // Marker + popup
            var name = el.getAttribute('data-name') || '';
            var address = el.getAttribute('data-address') || '';
            var img = el.getAttribute('data-image') || '';
            var popupHtml = '<div style="max-width:220px">'+ (img ? '<img src="'+img+'" style="width:100%;height:110px;object-fit:cover;border-radius:6px;margin-bottom:6px" />' : '') +
                            '<strong>'+name+'</strong><br/>' + address + '</div>';
            new maplibregl.Marker({ color: '#fc036b' }).setLngLat([lng, lat]).setPopup(new maplibregl.Popup().setHTML(popupHtml)).addTo(map);
        });
        </script>

        <!-- Media Showcase JS -->
        <script>
        document.addEventListener('DOMContentLoaded', function(){
          var heroEl = document.querySelector('#media-showcase .media-hero');
          if(!heroEl) return;
          var images = (heroEl.getAttribute('data-images')||'').replace(/&quot;/g,'"');
          try { images = JSON.parse(images); } catch(e){ images = []; }
          var idx = 0;
          function setHero(src){ heroEl.style.transition = 'background-image .35s ease'; heroEl.style.backgroundImage = 'url("'+src+'")'; }
          function show(i){ if(!images.length) return; idx = (i+images.length)%images.length; setHero(images[idx]); }
          document.querySelectorAll('#media-showcase .thumb').forEach(function(btn){
            btn.addEventListener('click', function(){ var s=this.getAttribute('data-src'); var i = images.indexOf(s); if(i>-1){ show(i); } else { setHero(s); } });
          });
          var prevBtn = document.querySelector('#media-showcase .media-hero__nav.prev');
          var nextBtn = document.querySelector('#media-showcase .media-hero__nav.next');
          if(prevBtn) prevBtn.addEventListener('click', function(){ show(idx-1); });
          if(nextBtn) nextBtn.addEventListener('click', function(){ show(idx+1); });
          var zoomBtn = document.querySelector('#media-showcase .media-hero__zoom');
          var modal = document.getElementById('galleryModal');
          var modalImg = modal ? modal.querySelector('.modal-image img') : null;
          var modalClose = modal ? modal.querySelector('.modal-close') : null;
          var modalPrev = modal ? modal.querySelector('.nav-prev') : null;
          var modalNext = modal ? modal.querySelector('.nav-next') : null;
          var modalCounter = modal ? modal.querySelector('.image-counter') : null;
          function srcFromBg(){ var s = heroEl.style.backgroundImage || ''; return s.replace(/^url\("|"\)$/g,''); }
          function openModal(){ if(!modal || !modalImg) return; if(!images.length){ modalImg.src = srcFromBg(); } else { modalImg.src = images[idx]; } if(modalCounter){ modalCounter.textContent = (idx+1)+' / '+(images.length||1); } modal.classList.add('active'); }
          function closeModal(){ if(modal) modal.classList.remove('active'); }
          if(zoomBtn) zoomBtn.addEventListener('click', openModal);
          if(modalClose) modalClose.addEventListener('click', closeModal);
          if(modalPrev) modalPrev.addEventListener('click', function(){ show(idx-1); if(modalImg){ modalImg.src = images[idx]; if(modalCounter){ modalCounter.textContent = (idx+1)+' / '+images.length; } } });
          if(modalNext) modalNext.addEventListener('click', function(){ show(idx+1); if(modalImg){ modalImg.src = images[idx]; if(modalCounter){ modalCounter.textContent = (idx+1)+' / '+images.length; } } });
        });
        </script>

        <!-- Initialize Review Widgets -->
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            initializeReviewWidgets();
        });

        function initializeReviewWidgets() {
            var widgetWrapper = document.querySelector('.widget-wrapper');
            if (!widgetWrapper) return;

            widgetWrapper.classList.add('loading');

            var shapoWidget = document.getElementById('shapo-widget-5e8084e2fdcaa2cd9b10');
            if (shapoWidget) {
                var observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                            widgetWrapper.classList.remove('loading');
                            widgetWrapper.classList.add('loaded');
                        }
                    });
                });
                observer.observe(shapoWidget, { childList: true, subtree: true });

                setTimeout(function() {
                    if (widgetWrapper.classList.contains('loading')) {
                        widgetWrapper.classList.remove('loading');
                        widgetWrapper.classList.add('loaded');
                    }
                }, 5000);
            } else {
                widgetWrapper.classList.remove('loading');
            }
        }
        </script>
    </body>
    </html>
